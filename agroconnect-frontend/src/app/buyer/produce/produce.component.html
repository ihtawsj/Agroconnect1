<div class="main-content">
  <div class="container">
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="mb-1" style="color: var(--primary-green);">Fresh Produce</h1>
            <p class="text-muted">Discover fresh fruits, vegetables, and more from local farmers</p>
          </div>
          <div class="d-flex align-items-center" *ngIf="!loading && !error">
            <i class="fas fa-leaf me-2" style="font-size: 1.5rem; color: var(--success);"></i>
            <span class="badge bg-success">{{ filteredProduceList.length }} items available</span>
            
            <!-- Authentication Status -->
            <div class="ms-3">
              <span class="badge" [class]="isLoggedIn() ? 'bg-success' : 'bg-danger'">
                <i class="fas" [class]="isLoggedIn() ? 'fa-check-circle' : 'fa-times-circle'"></i>
                {{ isLoggedIn() ? 'Logged In' : 'Not Logged In' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="row mb-4" *ngIf="!loading && !error">
      <div class="col-12">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-light border-0 py-3">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0 fw-bold text-primary">
                <i class="fas fa-filter me-2"></i>
                Filter & Sort Products
              </h6>
              <button 
                class="btn btn-outline-secondary btn-sm" 
                (click)="clearFilters()"
                [disabled]="!hasActiveFilters()"
              >
                <i class="fas fa-times me-1"></i>Clear All
              </button>
            </div>
          </div>
          <div class="card-body py-4">
            <!-- Category and Sort Row -->
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold text-muted small mb-2">
                  <i class="fas fa-tags me-1"></i>Product Category
                </label>
                <select 
                  class="form-select form-select-lg" 
                  [(ngModel)]="selectedCategory"
                  (change)="applyFilters()"
                >
                  <option value="">All Categories</option>
                  <option value="vegetables">ü•¨ Vegetables</option>
                  <option value="fruits">üçé Fruits</option>
                  <option value="meat">ü•© Meat</option>
                  <option value="dairy">ü•õ Dairy</option>
                  <option value="other">üì¶ Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold text-muted small mb-2">
                  <i class="fas fa-sort-amount-down me-1"></i>Sort By
                </label>
                <select 
                  class="form-select form-select-lg" 
                  [(ngModel)]="sortBy"
                  (change)="applyFilters()"
                >
                  <option value="">Default Order</option>
                  <option value="price-low">Price: Low to High</option>
                  <option value="price-high">Price: High to Low</option>
                  <option value="quantity-low">Quantity: Low to High</option>
                  <option value="quantity-high">Quantity: High to Low</option>
                  <option value="name">Name: A to Z</option>
                </select>
              </div>
            </div>
            
            <!-- Active Filters Display -->
            <div class="mt-3" *ngIf="hasActiveFilters()">
              <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-primary-subtle text-primary border">
                  <i class="fas fa-filter me-1"></i>Filters Active
                </span>
                <span class="badge bg-success-subtle text-success border" *ngIf="selectedCategory">
                  Category: {{ selectedCategory }}
                </span>
                <span class="badge bg-secondary-subtle text-secondary border" *ngIf="sortBy">
                  Sort: {{ getSortDisplayName() }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="row mb-3" *ngIf="loading">
      <div class="col-12">
        <div class="alert alert-info">
          <i class="fas fa-spinner fa-spin me-2"></i>
          <strong>Loading produce data...</strong><br>
          <small>Please wait while we fetch the latest produce from our database.</small>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div class="row mb-3" *ngIf="error">
      <div class="col-12">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Error Loading Produce</strong><br>
          <small>{{ error }}</small>
          <div class="mt-2">
            <button class="btn btn-outline-danger btn-sm" (click)="ngOnInit()">
              <i class="fas fa-redo me-1"></i>Retry
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Message -->
    <div class="row mb-3" *ngIf="successMessage">
      <div class="col-12">
        <div class="alert alert-success">
          <i class="fas fa-check-circle me-2"></i>
          <strong>Success!</strong> {{ successMessage }}
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="row mb-3" *ngIf="errorMessage">
      <div class="col-12">
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Error:</strong> {{ errorMessage }}
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="row" *ngIf="!loading && !error && filteredProduceList.length > 0">
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let item of filteredProduceList">
        <div class="card h-100 fade-in product-card">
          <div class="card-body d-flex flex-column">
            <div class="text-center mb-3">
              <!-- Product Image -->
              <div class="product-image mb-3">
                <img 
                  [src]="item.imageUrl ? ('http://localhost:8080' + item.imageUrl) : 'assets/default.png'" 
                  [alt]="item.name" 
                  width="350" 
                  height="350" 
                  class="rounded"
                  style="object-fit: cover;"
                />
              </div>
              <div class="product-icon mb-2">
                <i class="fas fa-seedling" style="font-size: 2.5rem; color: var(--primary-green);"></i>
              </div>
              <h5 class="card-title mb-1">{{ item.name }}</h5>
              <div class="price-tag">
                <span class="badge bg-success fs-6">‚Çπ{{ item.price }}</span>
              </div>
              <small class="text-muted">{{ item.category }}</small>
            </div>
            
            <div class="product-details mb-3">
              <p class="card-text text-muted small">
                <i class="fas fa-info-circle me-1"></i>
                Available: {{ item.availableQuantity || item.quantity }} units
              </p>
              <p class="card-text text-muted small">
                <i class="fas fa-truck me-1"></i>
                Same day delivery available
              </p>
            </div>

            <div class="mt-auto">
              <div class="input-group mb-3">
                <span class="input-group-text">
                  <i class="fas fa-sort-numeric-up"></i>
                </span>
                <input 
                  type="number" 
                  class="form-control" 
                  [value]="quantities[item.id] || ''" 
                  min="1" 
                  [max]="item.availableQuantity || item.quantity"
                  placeholder="Quantity"
                  style="text-align: center;"
                  #quantityInput
                  (input)="onQuantityChange(item.id, +quantityInput.value || 0)"
                  (blur)="onQuantityChange(item.id, +quantityInput.value || 0)"
                  (keyup.enter)="onQuantityChange(item.id, +quantityInput.value || 0)"
                  [class.is-invalid]="quantities[item.id] && (quantities[item.id] <= 0 || quantities[item.id] > (item.availableQuantity || item.quantity))"
                />
                <span class="input-group-text">units</span>
              </div>
              
              <!-- Validation Message -->
              <div class="mb-3" *ngIf="quantities[item.id] && (quantities[item.id] <= 0 || quantities[item.id] > (item.availableQuantity || item.quantity))">
                <small class="text-danger">
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  <span *ngIf="quantities[item.id] <= 0">Quantity must be at least 1</span>
                  <span *ngIf="quantities[item.id] > (item.availableQuantity || item.quantity)">Only {{ item.availableQuantity || item.quantity }} units available</span>
                </small>
              </div>
              
              <button 
                class="btn btn-success w-100" 
                (click)="addToCart(item.id)"
                [disabled]="!quantities[item.id] || quantities[item.id] <= 0 || quantities[item.id] > (item.availableQuantity || item.quantity) || isAddingToCart"
              >
                <i class="fas fa-cart-plus me-2" *ngIf="!isAddingToCart"></i>
                <i class="fas fa-spinner fa-spin me-2" *ngIf="isAddingToCart"></i>
                <span *ngIf="!quantities[item.id] || quantities[item.id] <= 0 || quantities[item.id] > (item.availableQuantity || item.quantity)">
                  Add to Cart
                </span>
                <span *ngIf="quantities[item.id] && quantities[item.id] > 0 && quantities[item.id] <= (item.availableQuantity || item.quantity) && !isAddingToCart">
                  Add {{ quantities[item.id] }} to Cart
                </span>
                <span *ngIf="isAddingToCart">
                  Adding...
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && !error && filteredProduceList.length === 0">
      <i class="fas fa-seedling"></i>
      <h4>No Products Found</h4>
      <p *ngIf="hasActiveFilters()">No products match your current filters. Try adjusting your search criteria or clear all filters.</p>
      <p *ngIf="!hasActiveFilters()">No produce items found in the database. Please check back later.</p>
      <button 
        *ngIf="hasActiveFilters()" 
        class="btn btn-outline-primary mt-3" 
        (click)="clearFilters()"
      >
        <i class="fas fa-times me-1"></i>Clear All Filters
      </button>
    </div>

    <!-- Quick Actions -->
    <div class="row mt-5" *ngIf="!loading && !error">
      <div class="col-12">
        <div class="card">
          <div class="card-body text-center">
            <h5 class="card-title mb-3">Need Help?</h5>
            <div class="row">
              <div class="col-md-6">
                <i class="fas fa-phone mb-2" style="font-size: 1.5rem; color: var(--info);"></i>
                <p class="small mb-1">Call Support</p>
                <p class="mb-0"><strong>7356483542</strong></p>
                <p class="mb-0"><strong>7012579549</strong></p>
              </div>
              <div class="col-md-6">
                <i class="fas fa-question-circle mb-2" style="font-size: 1.5rem; color: var(--primary);"></i>
                <p class="small mb-1">Need Help!</p>
                <p class="mb-0">reachout to <strong>agroconnect&#64;gmail.com</strong></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
